<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>灵感图库 & 画师组合</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f4f6f8; --sidebar-w: 250px; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* 侧边栏 */
        .sidebar {
            width: var(--sidebar-w); background: white; border-right: 1px solid #ddd;
            display: flex; flex-direction: column; height: 100%; box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 10;
        }
        .sidebar-header { padding: 20px; font-weight: bold; font-size: 18px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;}
        .home-link { font-size: 12px; color: var(--primary); text-decoration: none; }
        
        .nav-tabs { display: flex; padding: 10px; gap: 10px; background: #fafafa; }
        .tab { flex: 1; text-align: center; padding: 8px; cursor: pointer; border-radius: 4px; font-size: 14px; color: #666; }
        .tab.active { background: var(--primary); color: white; font-weight: bold; }

        .nav-list { flex: 1; overflow-y: auto; padding: 10px; }
        .nav-item {
            padding: 10px 15px; margin-bottom: 5px; cursor: pointer; border-radius: 6px;
            font-size: 14px; color: #444; transition: 0.2s;
        }
        .nav-item:hover { background: #f0f7ff; }
        .nav-item.active { background: #e1f0ff; color: var(--primary); font-weight: 600; border-left: 3px solid var(--primary); }

        /* 主内容区 */
        .main { flex: 1; overflow-y: auto; padding: 30px; scroll-behavior: smooth; position: relative; }
        
        .section-title { font-size: 24px; color: #333; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee; }

        .card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 40px; overflow: hidden; display: flex; flex-direction: column; }
        
        .card-header { padding: 15px 20px; background: #fff; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between; }
        .card-title { font-size: 18px; font-weight: bold; color: #333; }
        .card-tag { font-size: 12px; padding: 3px 8px; border-radius: 4px; background: #eee; color: #666; }
        .card-tag.run { background: #e8f5e9; color: #2e7d32; } /* 精选图 */
        .card-tag.combo { background: #e3f2fd; color: #1565c0; } /* 画师串 */

        .card-body { display: flex; flex-wrap: wrap; }
        .card-img { flex: 1; min-width: 300px; max-width: 600px; cursor: zoom-in; }
        .card-img img { width: 100%; height: auto; display: block; }
        
        .card-prompt { flex: 1; min-width: 300px; padding: 20px; background: #fafafa; border-left: 1px solid #eee; display: flex; flex-direction: column; }
        .prompt-label { font-size: 12px; color: #999; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
        .prompt-text { 
            flex: 1; background: white; border: 1px solid #ddd; padding: 10px; 
            border-radius: 6px; font-family: 'Consolas', monospace; font-size: 13px; 
            line-height: 1.5; color: #444; word-break: break-all; margin-bottom: 15px;
            max-height: 400px; overflow-y: auto;
        }
        
        .btn-copy {
            align-self: flex-start; background: var(--primary); color: white; border: none;
            padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;
            transition: 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .btn-copy:hover { background: #357abd; }
        .btn-copy:active { transform: scale(0.95); }

        /* 灯箱 */
        #lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; cursor: zoom-out; }
        #lightbox img { max-width: 95%; max-height: 95%; border-radius: 4px; box-shadow: 0 0 20px rgba(255,255,255,0.2); }

        /* 提示框 */
        .toast { visibility: hidden; position: fixed; left: 50%; bottom: 30px; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 4px; z-index: 2000; opacity: 0; transition: 0.3s; }
        .toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        @media (max-width: 768px) {
            body { flex-direction: column; height: auto; overflow: visible; }
            .sidebar { width: 100%; height: auto; position: sticky; top: 0; border-right: none; border-bottom: 1px solid #ddd; }
            .nav-list { display: none; } /* 手机端隐藏列表，太长了 */
            .main { padding: 15px; overflow: visible; }
            .card-body { flex-direction: column; }
            .card-prompt { border-left: none; border-top: 1px solid #eee; }
        }
    </style>
</head>
<body>

    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-header">
            图库导航
            <a href="index.html" class="home-link">← 回主页</a>
        </div>
        <div class="nav-tabs">
            <div class="tab active" onclick="filterTab('all', this)">全部</div>
            <div class="tab" onclick="filterTab('run', this)">精选图</div>
            <div class="tab" onclick="filterTab('combo', this)">画师串</div>
        </div>
        <div class="nav-list" id="nav-list">
            <!-- JS 生成 -->
        </div>
    </div>

    <!-- 主内容 -->
    <div class="main" id="main-content">
        <!-- JS 生成卡片 -->
    </div>

    <!-- 灯箱 -->
    <div id="lightbox" onclick="this.style.display='none'"><img id="lb-img"></div>
    <div id="toast" class="toast">已复制到剪贴板</div>

    <script>
        let allData = [];
        let currentFilter = 'all';

        fetch('showcase.json')
            .then(res => res.json())
            .then(data => {
                allData = data;
                render();
            })
            .catch(() => {
                document.getElementById('main-content').innerHTML = "<div style='text-align:center; padding:50px; color:#999'>暂无数据，请使用 manage_gallery.py 添加。</div>";
            });

        function render() {
            const navList = document.getElementById('nav-list');
            const mainContent = document.getElementById('main-content');
            
            navList.innerHTML = '';
            mainContent.innerHTML = '';

            // 过滤数据
            const filtered = allData.filter(item => currentFilter === 'all' || item.category === currentFilter);

            if (filtered.length === 0) {
                mainContent.innerHTML = "<div style='text-align:center; padding:50px; color:#999'>该分类下暂无内容。</div>";
                return;
            }

            filtered.forEach((item, index) => {
                // 1. 生成侧边栏导航项
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.innerText = item.title;
                navItem.onclick = () => {
                    document.getElementById(`card-${item.id}`).scrollIntoView({ behavior: 'smooth' });
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    navItem.classList.add('active');
                };
                navList.appendChild(navItem);

                // 2. 生成主内容卡片
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${item.id}`; // 锚点

                const tagClass = item.category === 'run' ? 'run' : 'combo';
                const tagName = item.category === 'run' ? '精选 Run' : '画师 Combo';

                card.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${item.title}</span>
                        <span class="card-tag ${tagClass}">${tagName}</span>
                    </div>
                    <div class="card-body">
                        <div class="card-img" onclick="openLightbox('${item.image}')">
                            <img src="${item.image}" loading="lazy" alt="${item.title}">
                        </div>
                        <div class="card-prompt">
                            <div class="prompt-label">Prompt / 组合代码</div>
                            <div class="prompt-text">${escapeHtml(item.prompt)}</div>
                            <button class="btn-copy" onclick="copyText(this, '${escapeHtml(item.prompt.replace(/'/g, "\\'"))}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                复制
                            </button>
                        </div>
                    </div>
                `;
                mainContent.appendChild(card);
            });
        }

        function filterTab(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            render();
        }

        function openLightbox(src) {
            document.getElementById('lb-img').src = src;
            document.getElementById('lightbox').style.display = 'flex';
        }

        function copyText(btn, text) {
            navigator.clipboard.writeText(text).then(() => {
                const t = document.getElementById('toast');
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 2000);
                
                const oldText = btn.innerHTML;
                btn.innerHTML = "已复制 ✓";
                setTimeout(() => btn.innerHTML = oldText, 1000);
            });
        }
        
        function escapeHtml(text) {
            if (!text) return "";
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
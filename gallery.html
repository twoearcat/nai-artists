<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµæ„Ÿå›¾åº“ & ç”»å¸ˆç»„åˆ</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f4f6f8; --sidebar-w: 250px; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: var(--sidebar-w); background: white; border-right: 1px solid #ddd;
            display: flex; flex-direction: column; height: 100%; box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 10;
        }
        .sidebar-header { padding: 20px; font-weight: bold; font-size: 18px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;}
        .home-link { font-size: 12px; color: var(--primary); text-decoration: none; }
        
        .nav-tabs { display: flex; padding: 10px; gap: 10px; background: #fafafa; }
        .tab { flex: 1; text-align: center; padding: 8px; cursor: pointer; border-radius: 4px; font-size: 14px; color: #666; }
        .tab.active { background: var(--primary); color: white; font-weight: bold; }

        .nav-list { flex: 1; overflow-y: auto; padding: 10px; }
        .nav-item {
            padding: 10px 15px; margin-bottom: 5px; cursor: pointer; border-radius: 6px;
            font-size: 14px; color: #444; transition: 0.2s;
        }
        .nav-item:hover { background: #f0f7ff; }
        .nav-item.active { background: #e1f0ff; color: var(--primary); font-weight: 600; border-left: 3px solid var(--primary); }

        /* ä¸»å†…å®¹åŒº */
        .main { flex: 1; overflow-y: auto; padding: 30px; scroll-behavior: smooth; position: relative; }
        
        .section-title { font-size: 24px; color: #333; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee; }

        .card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 40px; overflow: hidden; display: flex; flex-direction: column; }
        
        .card-header { padding: 15px 20px; background: #fff; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between; }
        .card-title { font-size: 18px; font-weight: bold; color: #333; }
        .card-tag { font-size: 12px; padding: 3px 8px; border-radius: 4px; background: #eee; color: #666; }
        .card-tag.run { background: #e8f5e9; color: #2e7d32; } /* ç²¾é€‰å›¾ */
        .card-tag.combo { background: #e3f2fd; color: #1565c0; } /* ç”»å¸ˆä¸² */

        .card-body { display: flex; flex-wrap: wrap; }
        .card-img { flex: 1; min-width: 300px; max-width: 600px; cursor: zoom-in; }
        .card-img img { width: 100%; height: auto; display: block; }
        
        .card-prompt { flex: 1; min-width: 300px; padding: 20px; background: #fafafa; border-left: 1px solid #eee; display: flex; flex-direction: column; }
        .prompt-label { font-size: 12px; color: #999; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
        .prompt-text { 
            flex: 1; background: white; border: 1px solid #ddd; padding: 10px; 
            border-radius: 6px; font-family: 'Consolas', monospace; font-size: 13px; 
            line-height: 1.5; color: #444;white-space: pre-wrap;
            word-break: break-all;margin-bottom: 15px;
            max-height: 400px; overflow-y: auto;
        }
        
        .btn-copy {
            align-self: flex-start; background: var(--primary); color: white; border: none;
            padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;
            transition: 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .btn-copy:hover { background: #357abd; }
        .btn-copy:active { transform: scale(0.95); }

        /* ç¯ç®± */
        #lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; cursor: zoom-out; }
        #lightbox img { max-width: 95%; max-height: 95%; border-radius: 4px; box-shadow: 0 0 20px rgba(255,255,255,0.2); }

        /* æç¤ºæ¡† */
        .toast { visibility: hidden; position: fixed; left: 50%; bottom: 30px; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 4px; z-index: 2000; opacity: 0; transition: 0.3s; }
        .toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        @media (max-width: 768px) {
            body { flex-direction: column; height: auto; overflow: visible; }
            .sidebar { width: 100%; height: auto; position: sticky; top: 0; border-right: none; border-bottom: 1px solid #ddd; }
            .nav-list { display: none; } /* æ‰‹æœºç«¯éšè—åˆ—è¡¨ï¼Œå¤ªé•¿äº† */
            .main { padding: 15px; overflow: visible; }
            .card-body { flex-direction: column; }
            .card-prompt { border-left: none; border-top: 1px solid #eee; }
        }
    </style>
</head>
<body>

    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="sidebar-header">
            å›¾åº“å¯¼èˆª
            <a href="index.html" class="home-link">â† å›ä¸»é¡µ</a>
        </div>
        <div class="nav-tabs">
            <div class="tab active" onclick="filterTab('all', this)">å…¨éƒ¨</div>
            <div class="tab" onclick="filterTab('run', this)">ç²¾é€‰å›¾</div>
            <div class="tab" onclick="filterTab('combo', this)">ç”»å¸ˆä¸²</div>
        </div>
        <div class="nav-list" id="nav-list">
            <!-- JS ç”Ÿæˆ -->
        </div>
                <div style="padding: 15px; border-top: 1px solid #eee; background: #fafafa;">
            <a href="https://dreamail.cn/send?dm=6d932bdf-6afa-4431-9423-4ed431794c57" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:12px; background:linear-gradient(to right, #ff7675, #d63031); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:14px; box-shadow: 0 4px 6px rgba(214, 48, 49, 0.2); transition: transform 0.1s;" onmousedown="this.style.transform='scale(0.98)'" onmouseup="this.style.transform='scale(1)'">
                    ğŸ“® æŠ•ç¨¿ Prompt
                </button>
            </a>
        </div>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="main" id="main-content">
        <!-- JS ç”Ÿæˆå¡ç‰‡ -->
    </div>

    <!-- ç¯ç®± -->
    <div id="lightbox" onclick="this.style.display='none'"><img id="lb-img"></div>
    <div id="toast" class="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

<script>
        let allData = [];
        let currentFilter = 'all';

        // è¯»å–æ•°æ®
        fetch('showcase.json')
            .then(res => res.json())
            .then(data => {
                allData = data;
                render();
            })
            .catch(() => {
                document.getElementById('main-content').innerHTML = "<div style='text-align:center; padding:50px; color:#999'>æš‚æ— æ•°æ®ï¼Œè¯·ä½¿ç”¨ manage_gallery.py æ·»åŠ ã€‚</div>";
            });

        function render() {
            const navList = document.getElementById('nav-list');
            const mainContent = document.getElementById('main-content');
            
            navList.innerHTML = '';
            mainContent.innerHTML = '';

            // è¿‡æ»¤æ•°æ®
            const filtered = allData.filter(item => currentFilter === 'all' || item.category === currentFilter);

            if (filtered.length === 0) {
                mainContent.innerHTML = "<div style='text-align:center; padding:50px; color:#999'>è¯¥åˆ†ç±»ä¸‹æš‚æ— å†…å®¹ã€‚</div>";
                return;
            }

            filtered.forEach((item) => {
                // 1. ç”Ÿæˆä¾§è¾¹æ å¯¼èˆªé¡¹
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.innerText = item.title;
                navItem.onclick = () => {
                    document.getElementById(`card-${item.id}`).scrollIntoView({ behavior: 'smooth' });
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    navItem.classList.add('active');
                };
                navList.appendChild(navItem);

                // 2. ç”Ÿæˆä¸»å†…å®¹å¡ç‰‡
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${item.id}`; // é”šç‚¹

                const tagClass = item.category === 'run' ? 'run' : 'combo';
                const tagName = item.category === 'run' ? 'ç²¾é€‰ Run' : 'ç”»å¸ˆ Combo';

                // === å…³é”®ä¿®å¤ç‚¹ ===
                // ä½¿ç”¨ encodeURIComponent å¯¹ prompt è¿›è¡Œç¼–ç ï¼Œé˜²æ­¢æ¢è¡Œç¬¦æˆ–å¼•å·ç ´å HTML ç»“æ„
                const safePrompt = encodeURIComponent(item.prompt || ""); 

                card.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${escapeHtml(item.title)}</span>
                        <span class="card-tag ${tagClass}">${tagName}</span>
                    </div>
                    <div class="card-body">
                        <div class="card-img" onclick="openLightbox('${item.image}')">
                            <img src="${item.image}" loading="lazy" alt="${escapeHtml(item.title)}">
                        </div>
                        <div class="card-prompt">
                            <div class="prompt-label">Prompt / ç»„åˆä»£ç </div>
                            <div class="prompt-text">${escapeHtml(item.prompt)}</div>
                            <!-- è¿™é‡Œçš„ onclick ä¼ é€’çš„æ˜¯ç¼–ç åçš„å­—ç¬¦ä¸² -->
                            <button class="btn-copy" onclick="copyText(this, '${safePrompt}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                å¤åˆ¶
                            </button>
                        </div>
                    </div>
                `;
                mainContent.appendChild(card);
            });
        }

        function filterTab(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            render();
        }

        function openLightbox(src) {
            document.getElementById('lb-img').src = src;
            document.getElementById('lightbox').style.display = 'flex';
        }

        // === å…³é”®ä¿®å¤ç‚¹ ===
        // æ¥æ”¶ç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œå…ˆè§£ç å†å¤åˆ¶
        function copyText(btn, encodedText) {
            try {
                const text = decodeURIComponent(encodedText);
                navigator.clipboard.writeText(text).then(() => {
                    // æ˜¾ç¤º Toast
                    const t = document.getElementById('toast');
                    t.classList.add('show');
                    setTimeout(() => t.classList.remove('show'), 2000);
                    
                    // æŒ‰é’®åé¦ˆ
                    const oldHtml = btn.innerHTML;
                    btn.innerHTML = "å·²å¤åˆ¶ âœ“";
                    // 1ç§’åæ¢å¤æŒ‰é’®åŸæ ·
                    setTimeout(() => btn.innerHTML = oldHtml, 1000);
                }).catch(err => {
                    console.error("å¤åˆ¶å¤±è´¥:", err);
                    alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶");
                });
            } catch (e) {
                console.error("è§£ç å¤±è´¥:", e);
            }
        }
        
        function escapeHtml(text) {
            if (!text) return "";
            return text.replace(/&/g, "&amp;")
                       .replace(/</g, "&lt;")
                       .replace(/>/g, "&gt;")
                       .replace(/"/g, "&quot;")
                       .replace(/'/g, "&#039;");
        }
    </script>
    <!-- å›é¡¶æŒ‰é’® (Galleryç‰ˆ) -->
<button id="backToTop" class="back-to-top" onclick="document.querySelector('.main').scrollTo({top: 0, behavior: 'smooth'})">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg>
</button>

<style>
    .back-to-top {
        position: fixed; bottom: 30px; right: 30px;
        width: 50px; height: 50px; border-radius: 50%;
        background-color: var(--primary, #4a90e2); color: white; border: none;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        opacity: 0; visibility: hidden; transition: all 0.3s; z-index: 900;
    }
    .back-to-top.show { opacity: 1; visibility: visible; bottom: 40px; }
    .back-to-top:hover { background-color: #357abd; transform: translateY(-3px); }
</style>

<script>
    // ç›‘å¬ .main åŒºåŸŸæ»šåŠ¨
    const mainArea = document.querySelector('.main');
    if (mainArea) {
        mainArea.addEventListener('scroll', () => {
            const btn = document.getElementById('backToTop');
            if (mainArea.scrollTop > 300) btn.classList.add('show');
            else btn.classList.remove('show');
        });
    }
</script>
</body>
</html>